# v0.0.4b Implementation Plan: Gantt Visualization (Roadmap View)

## Overview

This version focuses on visualizing the calculated roadmap schedule on a **new, dedicated Roadmap page** (`pages/roadmap/index.tsx`). It builds upon the data and scheduling logic established in `v0.0.4a` and keeps the existing `/initiatives` page separate for data entry.

1.  **Create Roadmap Page:** Create the basic structure for `pages/roadmap/index.tsx`.
2.  **Integrate Scheduling Calculation:** Fetch initiative and capacity data on the new Roadmap page and use the `calculateRoadmapSchedule` utility to generate the schedule (`ScheduledInitiative[]`).
3.  **Create Gantt Component:** Develop a new React component (`components/roadmap/RoadmapGantt.tsx`) responsible for rendering the schedule visually.
4.  **Visualization Integration:** Render the `RoadmapGantt` component on the new Roadmap page, passing it the calculated schedule data.

The outcome will be the first visual representation of the capacity-constrained roadmap timeline within the application UI, accessible at `/roadmap`.

## Prerequisites

-   Completion of `v0.0.4a` (Data seeding, `calculateRoadmapSchedule` function implemented and tested).
-   Access to the application development environment (Replit).
-   Supabase project access (for data fetching).
-   Chrome browser for testing/debugging.

## Test Environment

-   Browser: Chrome latest version
-   Screen size: Desktop viewport (e.g., 1920x1080)

## Database Updates

No database schema changes are required for this version.

## Component & Configuration Updates

### 1. New Roadmap Page (`pages/roadmap/index.tsx`) Creation & Integration

*   **Action:** Create the new page to host the Gantt visualization.
*   **Structure:** Set up a basic React component structure, likely using `MainLayout`.
*   **Data Fetching:**
    *   Fetch all `initiatives` for the logged-in user.
    *   Fetch all `monthly_capacity` data for the logged-in user, ensuring it covers the relevant planning horizon.
*   **Schedule Calculation:**
    *   Import `calculateRoadmapSchedule` from `../../utils/schedulingUtils.ts`.
    *   In a `useEffect` hook (or similar data-fetching mechanism), call `calculateRoadmapSchedule` with the fetched initiatives and capacity data.
    *   Store the resulting `ScheduledInitiative[]` array in the page's state.
*   **Component Integration:**
    *   Import the new `RoadmapGantt` component (see below).
    *   Render the `RoadmapGantt` component, passing the calculated `ScheduledInitiative[]` array as a prop.
    *   Handle loading and error states during data fetching and calculation.
*   **Navigation:** Verify the existing main navigation link points to `/roadmap`.

### 2. Gantt Chart Component (`components/roadmap/RoadmapGantt.tsx`) Creation

*   **Action:** Create a new component to render the Gantt-style chart.
*   **Props:** The component should accept the `scheduledInitiatives: ScheduledInitiative[]` as input.
*   **Visualization Logic (Using Recharts `BarChart` - initial approach):**
    1.  **Data Preparation:**
        *   Filter out initiatives where `roadmap_delivery_month` is `null`.
        *   Determine the overall time range (min/max dates) from the scheduled initiatives and capacity data to set up the X-axis (Time).
        *   Map the `ScheduledInitiative[]` data into a format suitable for Recharts `BarChart`. This might involve:
            *   Y-axis: Initiative names (or IDs).
            *   X-axis: Months within the planning horizon.
            *   Data points representing the delivery month for each initiative. Consider representing delivery as a bar positioned within the corresponding month. *Initial scope: Show delivery month only, not full duration.*
    2.  **Chart Implementation:**
        *   Use Recharts components (`ResponsiveContainer`, `BarChart`, `XAxis` (Time), `YAxis` (Initiatives), `CartesianGrid`, `Tooltip`, `Bar`).
        *   Configure the XAxis to display months appropriately.
        *   Configure the YAxis to display initiative names.
        *   Render `<Bar>` elements, positioning them based on the `roadmap_delivery_month`.
    3.  **Styling & Interactivity:**
        *   Implement basic tooltips (`Tooltip`) to show initiative details (name, delivery month, effort) on hover.
        *   Conditionally style the bars (e.g., different color) if `deadline_missed` is `true`.
        *   Consider coloring bars based on `value_lever`.
*   **Alternative Libraries:** If Recharts proves unsuitable, research and potentially integrate a dedicated Gantt chart library compatible with React/Next.js.

## Success Criteria

1.  **Roadmap Page Exists:** The `pages/roadmap/index.tsx` file exists and defines the page component.
2.  **Data Fetched & Schedule Calculated:** The `pages/roadmap/index.tsx` successfully fetches initiative/capacity data and calls `calculateRoadmapSchedule` to generate the `ScheduledInitiative[]` array.
3.  **Gantt Component Exists:** The `components/roadmap/RoadmapGantt.tsx` file exists and defines the chart component.
4.  **Chart Renders:** The Gantt chart component is rendered on the new roadmap page (`/roadmap`).
5.  **Initiatives Displayed:** Scheduled initiatives (with non-null `roadmap_delivery_month`) are visually represented on the chart timeline, positioned according to their delivery month.
6.  **Tooltips Functional:** Hovering over an initiative representation on the chart displays a tooltip with basic details.
7.  **Deadline Status Visible:** Initiatives with `deadline_missed: true` are visually distinct (e.g., different color).
8.  **Unscheduled Handled:** Initiatives with `null` delivery month are not displayed on the chart timeline.

## Notes on Scope & Approach

*   This version focuses on displaying the calculated **delivery month**, not the full duration bar from start-to-finish (this would require tracking effort allocation per month per initiative, adding complexity).
*   The primary goal is a functional visualization on the main page; extensive styling or advanced features are out of scope for `v0.0.4b`.
*   Error handling for data fetching and chart rendering should be included.
*   This version focuses solely on the new `/roadmap` page and the `RoadmapGantt` component. No changes will be made to the existing `/initiatives`, `/capacity`, or `/metrics` pages or their underlying components.

## Manual Testing Steps

### 1. Verification of Gantt Chart Display
-   **Test 1.1:** Chart Rendering
    -   **Action:** Log in and navigate to the **new roadmap page (`/roadmap`)**.
    -   **Expected Result:** The `RoadmapGantt` component renders. A chart with axes (Time, Initiatives) is visible. No console errors related to chart rendering.
    -   **Status:** Passed (Duplicate navigation fixed)
-   **Test 1.2:** Initiative Positioning
    -   **Action:** Compare the visual position of several initiatives on the chart's timeline with their `roadmap_delivery_month` shown on the `/dev/test-schedule` page (or from the raw data).
    -   **Expected Result:** Initiatives are plotted correctly against the time axis corresponding to their delivery month. Mandatory items appear early, high-priority items generally before low-priority, respecting `start_month` constraints.
    -   **Status:** Passed

### 2. Verification of Features & Data Handling
-   **Test 2.1:** Tooltips
    -   **Action:** Hover over various initiative representations on the chart.
    -   **Expected Result:** A tooltip appears displaying at least the initiative name, calculated delivery month, and effort estimate.
    -   **Status:** Passed (Legibility fixed, value lever formatted)
-   **Test 2.2:** Deadline Miss Visualization
    -   **Action:** Locate initiatives flagged with `deadline_missed: true` in the test data (e.g., "Streamlined Loan Application Flow", "Very High Effort, Low Prio"). Observe their representation on the chart.
    -   **Expected Result:** These initiatives are visually distinct (e.g., different bar color) compared to initiatives where the deadline was met or not applicable.
    -   **Status:** Passed (Red bar marker + tooltip indication)
-   **Test 2.3:** Handling of Unscheduled Initiatives
    -   **Action:** Check for the initiative "Late Start, Low Prio" (which has `roadmap_delivery_month: null`).
    -   **Expected Result:** This initiative does *not* appear on the chart's timeline.
    -   **Status:** Passed
-   **Test 2.4:** Start Month Constraint Visualization
    -   **Action:** Observe the position of "Referral Program Launch" (`start_month: '2025-11-01'`).
    -   **Expected Result:** The initiative appears on the chart at or after Nov 2025, even if capacity might have been available earlier.
    -   **Status:** Passed

### 3. Regression Checks
-   **Test 3.1:** Core Functionality Sanity Check
    -   **Action:** Briefly perform main actions: Log in/out, view/add/edit/delete initiative on the `/initiatives` page, view metrics (`/metrics`), view capacity (`/capacity`), view the **new roadmap page (`/roadmap`)**.
    -   **Expected Result:** All basic functions work without new console errors or unexpected behavior. The addition of the Gantt chart page should not break existing functionality on other pages.
    -   **Status:** Passed 