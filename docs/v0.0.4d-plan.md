# v0.0.4d Implementation Plan: Enhance Gantt Visualization (Duration Bars)

## Overview

This version focuses on enhancing the Roadmap page (`/roadmap`) visualization. The goal is to transition from simple delivery month markers to full duration bars on the Gantt chart, providing a clearer timeline view of scheduled initiatives.

1.  **Refactor Gantt Component:** Modify the `RoadmapGantt` component (`components/roadmap/RoadmapGantt.tsx`) to consume the scheduled initiatives data (including `roadmap_start_month` and `roadmap_delivery_month`) calculated in `v0.0.4c`.
2.  **Implement Duration Bars:** Update the Recharts implementation within `RoadmapGantt` to display each scheduled initiative as a horizontal bar spanning from its calculated `roadmap_start_month` to its `roadmap_delivery_month`.

The outcome will be a more conventional Gantt chart view on the `/roadmap` page, showing the planned duration and timing of initiatives based on the capacity-constrained schedule.

## Prerequisites

-   Completion of `v0.0.4c` (Enhanced scheduling logic with `roadmap_start_month` implemented and tested; Capacity view updated).
-   Access to the application development environment (Replit).
-   Supabase project access (for data fetching).
-   Chrome browser for testing/debugging.

## Test Environment

-   Browser: Chrome latest version
-   Screen size: Desktop viewport (e.g., 1920x1080)

## Database Updates

No database schema changes are required for this version. The `roadmap_start_month` and `roadmap_delivery_month` are calculated dynamically.

## Component & Configuration Updates

### 1. Enhance `RoadmapGantt` Component (`components/roadmap/RoadmapGantt.tsx`)

*   **Action:** Modify the Recharts `BarChart` implementation to render duration bars instead of just end-month markers.
*   **Data Consumption:** Ensure the component correctly receives and utilizes the `ScheduledInitiative[]` array, specifically the `roadmap_start_month` and `roadmap_delivery_month` fields.
*   **Axis Configuration:**
    *   **Y-Axis:** Configure to display Initiative names (or IDs) vertically (likely type `category`).
    *   **X-Axis:** Configure to represent the time dimension (months). This axis should be type `number`, representing time numerically (e.g., month index or timestamp). Define the `domain` based on the earliest `roadmap_start_month` and latest `roadmap_delivery_month` across all scheduled initiatives. Implement `tickFormatter` to display readable month labels (e.g., "Apr 2025").
*   **Bar Rendering Logic:**
    *   The core change involves how the `<Bar>` element is rendered. A standard bar typically extends from the baseline. For a Gantt representation, the bar needs a specific start and end point on the X-axis corresponding to the initiative's start and delivery months.
    *   **Approach:** Utilize the `<Bar>` component's `shape` prop to render a custom rectangle (`<rect>`).
    *   **Custom Shape Function:**
        *   The function provided to `shape` will receive properties like `x`, `y`, `width`, `height`, and the initiative's data (`payload`).
        *   Convert the `payload.roadmap_start_month` and `payload.roadmap_delivery_month` into numerical values consistent with the X-axis scale.
        *   Calculate the starting `x` coordinate based on the numerical representation of `roadmap_start_month`.
        *   Calculate the `width` of the rectangle based on the difference between the numerical representations of `roadmap_delivery_month` and `roadmap_start_month` (representing the duration). Remember to account for the bar representing the *entire* delivery month (e.g., bar extends to the *start* of the *next* month).
        *   Use the provided `y` and `height` for vertical positioning and thickness.
        *   Retain conditional fill logic (e.g., using red for `deadline_missed: true`, different colors for `value_lever`).
*   **Data Transformation (if needed):** Prepare the `scheduledInitiatives` data into a format suitable for the chart, potentially calculating the numerical start/end points for each initiative before passing it to the Recharts component.
*   **Tooltips:** Update the `<Tooltip>` content to display relevant information for the duration bar (e.g., Name, Start Month, Delivery Month, Effort, Deadline Missed).
*   **(Optional) `ResponsiveContainer`:** Investigate re-adding `<ResponsiveContainer>` if the previous linter issues can be resolved, to allow the chart to resize dynamically.

## Success Criteria

1.  **Roadmap Page Loads:** The `/roadmap` page loads without errors.
2.  **Gantt Renders Bars:** The `RoadmapGantt` component displays horizontal bars for scheduled initiatives instead of just markers.
3.  **Correct Duration:** Each bar accurately spans the timeline from the initiative's `roadmap_start_month` to its `roadmap_delivery_month`.
4.  **Correct Positioning:** Bars are correctly aligned vertically with initiative names/labels and horizontally with the time axis.
5.  **Tooltips Updated:** Tooltips display relevant information when hovering over a bar.
6.  **Conditional Formatting:** Bar coloring (e.g., for `deadline_missed`, `value_lever`) is correctly applied.
7.  **Handles Edge Cases:** Correctly renders initiatives starting/ending in the same month (short bar) and does not render unscheduled initiatives.

## Notes on Scope & Approach

*   Focuses solely on the `/roadmap` page and `RoadmapGantt` component.
*   Does not involve changes to scheduling logic (`utils/schedulingUtils.ts`) or other pages.
*   Assumes the primary challenge lies in configuring Recharts `BarChart` (or specifically its `Bar` element with a custom `shape`) for Gantt-style duration visualization.

## Manual Testing Steps

### 1. Verification of Gantt Bar Rendering
-   **Test 1.1:** Chart Rendering & Bar Display
    -   **Action:** Log in and navigate to the `/roadmap` page.
    -   **Expected Result:** The page loads, and the Gantt chart renders horizontal bars for initiatives. Check the browser console for errors.
    -   **Status:** TBD
-   **Test 1.2:** Bar Span Accuracy
    -   **Action:** Visually inspect several bars. Compare their start and end points against the `roadmap_start_month` and `roadmap_delivery_month` shown in the debug output on the page (or by inspecting component props). Check initiatives with varying durations (single month, multiple months).
    -   **Expected Result:** Bars visually align correctly with their start and delivery months on the time axis.
    -   **Status:** TBD
-   **Test 1.3:** Tooltip Content
    -   **Action:** Hover over several bars.
    -   **Expected Result:** Tooltips appear and display accurate information (Name, Start Month, Delivery Month, Effort).
    -   **Status:** TBD
-   **Test 1.4:** Conditional Coloring
    -   **Action:** Identify an initiative marked as `deadline_missed: true` in the schedule data.
    -   **Expected Result:** The corresponding bar in the Gantt chart is visually highlighted (e.g., colored red). Bars for different `value_lever` types might have distinct colors.
    -   **Status:** TBD
-   **Test 1.5:** Unscheduled Initiatives
    -   **Action:** Ensure the test data includes an initiative that cannot be scheduled (e.g., `Late Start, Low Prio` from `v0.0.4c` data).
    -   **Expected Result:** The unscheduled initiative does not appear as a bar on the Gantt chart.
    -   **Status:** TBD

### 2. Regression Checks
-   **Test 2.1:** Core Functionality Sanity Check
    -   **Action:** Briefly perform main actions: Log in/out, view `/initiatives`, view `/capacity`, view `/metrics`.
    -   **Expected Result:** All basic functions work without new console errors or unexpected behavior. Changes to the roadmap visualization should not break other pages.
    -   **Status:** TBD 