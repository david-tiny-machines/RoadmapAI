# v0.0.5a Implementation Plan: Backend Setup & Basic Conversation Endpoint

## Overview

This version focuses on setting up the foundational backend infrastructure for the AI PRD Agent feature, specifically creating the API endpoint and basic integration with the OpenAI API.

1.  **API Route Creation:** Establish the Next.js API route (`/api/agents/prd-generator`) that will handle requests for the PRD generation conversation.
2.  **OpenAI Client Integration:** Set up the necessary configuration and client instantiation for interacting with the OpenAI API (using the `openai` npm package).
3.  **Basic Interaction Logic:** Implement placeholder logic within the API route to receive a request (e.g., containing the start of a conversation or a user message) and return a hardcoded or very simple AI-generated response. This verifies the connection.
4.  **Session Handling (Placeholder):** Include comments or basic structure for where session management logic will eventually reside (e.g., storing conversation history), but defer full implementation. In-memory storage is acceptable for this initial version if needed for basic testing.

## Prerequisites

-   Access to the application development environment (Replit).
-   Access to the codebase.
-   OpenAI API Key available as an environment variable (e.g., `OPENAI_API_KEY`).
-   Installation of the `openai` npm package (`npm install openai`).

## Test Environment

-   API Testing Tool (e.g., Postman, Insomnia, or `curl`) for sending requests directly to the API endpoint.
-   Browser Developer Tools (Network tab) if testing indirectly.

## Database Updates

-   None required for this version. Session handling will be in-memory or deferred.

## Component & Configuration Updates

1.  **Environment Variables (`.env.local` or Replit Secrets):**
    *   **Action:** Ensure `OPENAI_API_KEY` is securely configured.
    *   **Details:** The API route will need access to this key to authenticate with OpenAI.

2.  **New API Route (`pages/api/agents/prd-generator.ts`):**
    *   **Action:** Create this new file.
    *   **Details:**
        *   Implement a request handler function (e.g., `export default async function handler(...)`).
        *   Add basic request body parsing (expecting a payload like `{ messages: [...] }`).
        *   Instantiate the OpenAI client using the API key.
        *   Implement placeholder logic: Initially, it might just log the incoming message and return a static response like `{ reply: "Hello! I am the PRD agent. How can I help?" }`.
        *   (Stretch Goal for 5a): Make a simple call to the OpenAI API (e.g., Chat Completions) with a basic prompt and return the AI's response.
        *   Include basic error handling (try/catch blocks) around the OpenAI call.
        *   Add comments indicating where conversation history/session management will be added later.

3.  **Package Installation (`package.json` / `npm install`):**
    *   **Action:** Install the `openai` package.
    *   **Details:** Run `npm install openai` in the Replit shell.

## Success Criteria

1.  The `openai` package is successfully installed and listed as a dependency.
2.  The environment variable `OPENAI_API_KEY` is accessible within the API route.
3.  The API route file `pages/api/agents/prd-generator.ts` exists and contains the basic handler structure.
4.  Sending a POST request (using an API testing tool) to `/api/agents/prd-generator` with a minimal valid JSON body (e.g., `{ "messages": [{"role": "user", "content": "Hi"}] }`) receives a successful HTTP response (e.g., 200 OK).
5.  The response body from the API endpoint contains the expected placeholder or simple AI-generated reply (e.g., `{ "reply": "..." }`).
6.  (If OpenAI call implemented): The API route successfully communicates with the OpenAI API and returns a response derived from the model.
7.  Basic error handling prevents the API route from crashing if the OpenAI call fails (e.g., returns a 500 Internal Server Error with a meaningful message).

## Notes on Scope & Approach

*   Focuses *only* on the backend API endpoint setup and initial OpenAI connection.
*   Does *not* include any frontend UI changes.
*   Does *not* implement robust conversation management or state persistence (only placeholders or in-memory for testing).
*   Prompt engineering will be very basic initially, just enough to test the connection.

## Manual Testing Steps

### 1. Environment Setup Verification
-   **Test 1.1:** Check OpenAI Package Installation
    -   **Action:** Check `package.json` and `node_modules` or run `npm list openai`.
    -   **Expected Result:** The `openai` package is listed as installed.
    -   **Status:** TBD
-   **Test 1.2:** Check API Key Access (Conceptual)
    -   **Action:** Review the API route code to confirm it attempts to read `process.env.OPENAI_API_KEY`.
    -   **Expected Result:** Code correctly references the environment variable.
    -   **Status:** TBD

### 2. API Endpoint Testing
-   **Test 2.1:** Send Basic POST Request
    -   **Action:** Using an API tool, send a POST request to `/api/agents/prd-generator` with header `Content-Type: application/json` and body `{ "messages": [{"role": "user", "content": "Hello"}] }`.
    -   **Expected Result:** Receive an HTTP 200 OK status code. The response body should contain a JSON object with a `reply` field containing the placeholder or simple AI response.
    -   **Status:** TBD
-   **Test 2.2:** Test Invalid Method
    -   **Action:** Send a GET request to `/api/agents/prd-generator`.
    -   **Expected Result:** Receive an HTTP 405 Method Not Allowed status code (or similar, depending on Next.js defaults).
    -   **Status:** TBD
-   **Test 2.3:** Test Basic Error Handling (If OpenAI call implemented)
    -   **Action:** Temporarily invalidate the API Key (e.g., set it to `invalid` in secrets) and repeat Test 2.1.
    -   **Expected Result:** Receive an HTTP 500 Internal Server Error status code (or potentially a 4xx from OpenAI forwarded). The response body should indicate an error occurred during the AI call, not a crash.
    -   **Action:** Restore the correct API Key.
    -   **Status:** TBD

### 3. Regression Checks
-   **Test 3.1:** Other API Routes
    -   **Action:** Briefly test one or two existing API routes (if any) to ensure they haven't been affected.
    -   **Expected Result:** Existing API routes function normally.
    -   **Status:** TBD
-   **Test 3.2:** Application Build
    -   **Action:** Run the build command (e.g., `npm run build` if applicable in Replit context).
    -   **Expected Result:** The application builds successfully without errors related to the new API route or dependencies.
    -   **Status:** TBD 